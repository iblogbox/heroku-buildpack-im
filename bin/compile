#!/usr/bin/env bash

indent() {
  sed -u 's/^/       /'
}

BUILD_DIR="$1"
SOURCE_DIR="$(dirname $0)/../compiled"
TARGET_DIR="$BUILD_DIR/vendor/im"

echo "-----> Copying files to $TARGET_DIR"

mkdir -p "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/anim_diff"
# cp "$SOURCE_DIR/anim_diff" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/cwebp"
# cp "$SOURCE_DIR/cwebp" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/dwebp"
# cp "$SOURCE_DIR/dwebp" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/gif2webp"
# cp "$SOURCE_DIR/gif2webp" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/JxrDecApp"
# cp "$SOURCE_DIR/JxrDecApp" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/JxrEncApp"
# cp "$SOURCE_DIR/JxrEncApp" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/vwebp"
# cp "$SOURCE_DIR/vwebp" "$TARGET_DIR"

# chmod +x "$SOURCE_DIR/webpmux"
# cp "$SOURCE_DIR/webpmux" "$TARGET_DIR"

chmod +x "$SOURCE_DIR/bpgdec"
cp "$SOURCE_DIR/bpgdec" "$TARGET_DIR"
cp "$SOURCE_DIR/libpng16.so.16.18.0" "$TARGET_DIR"
cp "$SOURCE_DIR/libpng16.so.16" "$TARGET_DIR"
cp "$SOURCE_DIR/libpng16.so" "$TARGET_DIR"

# update PATH and LD_LIBRARY_PATH
echo "-----> Updating environment variables"
PROFILE_PATH="$BUILD_DIR/.profile.d/im.sh"
mkdir -p $(dirname $PROFILE_PATH)
echo "export PATH=\$PATH:/app/vendor/im" >> $PROFILE_PATH
echo "export LD_LIBRARY_PATH=\$LD_LIBRARY_PATH:/app/vendor/im" >> $PROFILE_PATH
